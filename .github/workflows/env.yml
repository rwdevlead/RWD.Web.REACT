name: Environment Setup
on:
  workflow_call:
    secrets:
      VERCEL_ORG_ID:
        required: true
      VERCEL_PROJECT_ID:
        required: true
      VERCEL_TOKEN:
        required: true
      SLACK_WEBHOOK_URL:
        required: true
    outputs:
      NODE_VERSION:
        description: "Node version to use"
        value: ${{ jobs.load_env.outputs.NODE_VERSION }}
      VERCEL_ORG_ID:
        description: "Vercel organization ID"
        value: ${{ jobs.load_env.outputs.VERCEL_ORG_ID }}
      VERCEL_PROJECT_ID:
        description: "Vercel project ID"
        value: ${{ jobs.load_env.outputs.VERCEL_PROJECT_ID }}
      VERCEL_TOKEN:
        description: "Vercel token"
        value: ${{ jobs.load_env.outputs.VERCEL_TOKEN }}
      SLACK_WEBHOOK_URL:
        description: "Slack webhook URL"
        value: ${{ jobs.load_env.outputs.SLACK_WEBHOOK_URL }}

jobs:
  load_env:
    runs-on: ubuntu-latest
    outputs:
      NODE_VERSION: ${{ steps.set_env.outputs.NODE_VERSION }}
      VERCEL_ORG_ID: ${{ steps.set_env.outputs.VERCEL_ORG_ID }}
      VERCEL_PROJECT_ID: ${{ steps.set_env.outputs.VERCEL_PROJECT_ID }}
      VERCEL_TOKEN: ${{ steps.set_env.outputs.VERCEL_TOKEN }}
      SLACK_WEBHOOK_URL: ${{ steps.set_env.outputs.SLACK_WEBHOOK_URL }}
    steps:
      - id: set_env
        shell: bash
        run: |
          {
            echo "NODE_VERSION=20"
            echo "VERCEL_ORG_ID=${{ secrets.VERCEL_ORG_ID }}"
            echo "VERCEL_PROJECT_ID=${{ secrets.VERCEL_PROJECT_ID }}"
            echo "VERCEL_TOKEN=${{ secrets.VERCEL_TOKEN }}"
            echo "SLACK_WEBHOOK_URL=${{ secrets.SLACK_WEBHOOK_URL }}"
          } >> "$GITHUB_OUTPUT"
